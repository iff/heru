#!/usr/bin/env coffee

path = require 'path', fs = require 'fs'
runtime = fs.realpathSync path.join __dirname, '../';

require.paths.unshift path.join runtime, 'src'
require.paths.unshift path.join runtime, 'vendor'

heru = require 'heru'

sys = require 'sys'
os = require 'os'

{ join } = require 'path'
root = join __dirname, '..'

colors = require 'colors'
console.log "Heru #{ heru.Version.yellow } on #{ os.hostname().yellow }"

require.paths.unshift(process.env.PWD + '/library')

loadNode = ->
  hostname = process.argv[2]
  path = hostname.split('.').reverse()
  require join process.env.PWD, 'nodes', path.join('/')

spec = loadNode()
node = new heru.Node spec

try
  node.apply()
catch error
  console.log "Got an error:".red
  console.log error
  console.log error.stack

